C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TASK
OBJECT MODULE PLACED IN task.OBJ
COMPILER INVOKED BY: D:\Program Files\keil-3\C51\BIN\C51.EXE task.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /*************************************************************
   2                               Ê±ÖÓÏÔÊ¾³ÌÐò
   3          ³ÌÐò±àÐ´£ºFucp   2015-5-17
   4          DIYÌ×¼þ  http://59tiaoba.taobao.com
   5          
   6          µ¥Æ¬»ú IAP15W4K61S4  »òÕßÆäËû51  ¾§ÕñÆµÂÊ 18.432M  
   7          ×ÖÄ£Èí¼þÓÃ  PC2002
   8          ÖðÁÐÈ¡Ä£·½Ê½
   9          
  10          µç»úÐý×ª·½Ïò Ë³Ê±Õë
  11          /***********************************************************
  12          ËµÃ÷£º±¾³ÌÐòÖ§³ÖÅäÌ×Ò£¿ØÆ÷µ÷ÕûÊ±¼ä
  13          ²¥·Å°´¼ü  ÇÐ»»µ÷Õû Ê±¡¢·Ö¡¢Ãë¡¢ÔÂ¡¢ÈÕ
  14          ¼Ó °´¼ü£ºÔö¼Ó
  15          ¼õ °´¼ü£º¼õÉÙ
  16          menu°´¼ü£º Ê±ÖÓ¸´Î»
  17          
  18          Ò£¿ØÆ÷°´¼ü1 £ºÆ½ÃæÏÔÊ¾ÎÄ×Ö+²àÃæÏÔÊ¾Ê±ÖÓ  ¿Éµ÷Ê±
  19          Ò£¿ØÆ÷°´¼ü2 £ºÆ½ÃæÖ¸ÕëÊ±ÖÓ+²àÃæÏÔÊ¾ÎÄ×Ö
  20          *************************************************************/
  21          #include "NEW_8051.H"
  22          #include "intrins.h"
  23          #include "task.h"
  24          #define FOSC 18432000L          //ÏµÍ³ÆµÂÊ
  25          #define BAUD 115200             //´®¿Ú²¨ÌØÂÊ
  26          bit Scan_bit=0;   
  27          uint Offset=0;
  28          bit BIT_timeout=0;
  29          uchar ucMode=1;  //Ä£Ê½
  30          bit Time0_flag=0;       //¶¨Ê±Æ÷T0ÖÐ¶Ï±êÖ¾Î»
  31          uchar DISP_LINE=0;
  32          uint Pt=50,S0,T,D;              //¼ÆÊýÓÃµÄ±äÁ¿
  33          uchar ucAdder=0;
  34           uchar code TAB_12369[]=
  35           {
  36          
  37                  0xFF,0x03,0xFF,0xB3,0x6B,0x6B,0x9B,0xFF,                
  38                  0x8F,0x77,0x7F,0x8F,0x7F,0x77,0x8F,0xFF,//3
  39                  0xFF,0xFF,0x9F,0x6D,0x6D,0x6B,0x87,0xFF,//6     
  40                  0x9F,0xEF,0xF7,0x87,0x77,0x77,0x8F,0xFF,///9
  41          
  42          
  43           };
  44          /*********ÖÐ¶Ï×Ó³ÌÐò**********/
  45          void int0() interrupt 0 //Ê¹ÓÃÍâ²¿ÖÐ¶Ï0
  46          {
  47   1              BIT_timeout=1; //Æðµã±êÖ¾Î»
  48   1              if(ucMode!=1)
  49   1              {       
  50   2      
  51   2                              D+=(DISP_LINE-180)*2;   //ÐÞÕýÖµ
  52   2                              Pt=205+D; 
  53   2                  //µÃµ½¶¨Ê±Æ÷T0µÄ³õÉèÖµ
  54   2                      TH0=-Pt/256;
  55   2                      TL0=-Pt%256;   //ÉèÖÃ¶¨Ê±Æ÷T0µÄ³õÉèÖµ
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 2   

  56   2                      DISP_LINE=0;   //¼ÆÊýÆ÷ÇåÁã£¬½«ÖØÐÂ¼ÆÊý 
  57   2                      switch (ucMode)
  58   2                      {
  59   3                              case 0x02:
  60   3                                      du1302();//»ñÈ¡Ê±¼ä
  61   3                                      Sec=Sec/16*10+Sec%16 ;
  62   3                          Cent=Cent/16*10+Cent%16 ;
  63   3                              Hour=Hour/16*10+Hour%16 ;
  64   3                                      if(Hour>11)
  65   3                                      {
  66   4                                              Hour=Hour-12;   
  67   4                                      }
  68   3                                      Sec=Sec*3;//ÃëÕë¶¨Î»="Ãë"*3
  69   3                                      Hour=(Hour*15)+(Cent/4);//Ê±Õë¶¨Î»="Ê±"*15+"·Ö"/4
  70   3                                      Cent=Cent*3;//·ÖÕë¶¨Î»="·Ö"*3
  71   3                                      Offset++;
  72   3                                      if(Offset>480)//²àÃæÓÐ¶àÉÙÎÄ×Ö Õâ¸öÖµ¾Í¶ÔÓ¦¸Ä³É  ¶àÉÙ×Ö*16 
  73   3                                      Offset=0;       
  74   3                                      break;
  75   3                              case 0x03:
  76   3                                      du1302();//»ñÈ¡Ê±¼ä
  77   3                                      Sec=Sec/16*10+Sec%16 ;
  78   3                          Cent=Cent/16*10+Cent%16 ;
  79   3                              Hour=Hour/16*10+Hour%16 ;
  80   3                                      if(Hour>12)
  81   3                                      {
  82   4                                              Hour=Hour-12;   
  83   4                                      }
  84   3                                      break;
  85   3                              default:
  86   3                                      break;
  87   3                      }
  88   2              }
  89   1      }
  90          /******************************************/
  91          void Send_uart(unsigned char d)   /*´Ó´®¿Ú·¢ËÍÊý¾Ý*/
  92          {
  93   1                ES=0;
  94   1            SBUF=d;
  95   1                while(TI==0);       //µÈ´ý·¢ËÍÍê±Ï
  96   1            TI=0;
  97   1                ES=1;
  98   1      }
  99          /*************************************/
 100          //Í¼Æ¬ÇÐ»»ÒÔ¼°Ä£Äâ±íÅÌÏÔÊ¾º¯Êý
 101          void display_pic()
 102          {
 103   1              //uchar date1,date2,date3,date4;
 104   1              if(DISP_LINE<180)
 105   1              {
 106   2                      if(Time0_flag)
 107   2                      {
 108   3                              Time0_flag=0;
 109   3                              Close();
 110   3                              if(ucMode==2)
 111   3                              {
 112   4                                        //DISP_LINE=DISP_LINE-1;
 113   4                                            //±êÕûµã,ÒÔ¼°ÏÔÊ¾Êý×Ö12,3,6,9
 114   4                                    if ( (DISP_LINE >= 175) || (DISP_LINE <= 3))  //12µã
 115   4                                    {
 116   5                                     ucAdder=DISP_LINE+4 ;
 117   5                                     if ( ucAdder>=180) ucAdder=ucAdder-180 ;
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 3   

 118   5                                    }
 119   4                                    else if ( (DISP_LINE >= 41) && (DISP_LINE <= 48)) //3µã
 120   4                                    {
 121   5                                     ucAdder=DISP_LINE-41+8*1 ;
 122   5                                    }
 123   4                                    else if ( (DISP_LINE >= 86) && (DISP_LINE <= 93)) //6µã
 124   4                                    {
 125   5                                     ucAdder=DISP_LINE-86+8*2 ;
 126   5                                    }
 127   4                                    else if ( (DISP_LINE >= 131) && (DISP_LINE <= 138)) //9µã
 128   4                                    {
 129   5                                     ucAdder=DISP_LINE-131+8*3 ;
 130   5                                    }
 131   4                                        else
 132   4                                        {
 133   5                                               ucAdder=250;
 134   5                                              /*************ÐÎ³É±íÅÌ*******************/
 135   5                                         switch (DISP_LINE)    
 136   5                                     {
 137   6                                              case 180*1/12 :    //1µã
 138   6                                              case 180*2/12 :    //2µã
 139   6                                              case 180*4/12 :    //4µã
 140   6                                              case 180*5/12 :    //5µã
 141   6                                              case 180*7/12 :    //6µã
 142   6                                              case 180*8/12 :    //7µã
 143   6                                              case 180*10/12 :   //10µã
 144   6                                              case 180*11/12 :   //11µã
 145   6                                                //LED=0;
 146   6                                                        PortA(0X0F);
 147   6                                               break;
 148   6                                     }
 149   5                                         }
 150   4                                         if ( ucAdder < 32 )
 151   4                                          {
 152   5                                                      PortA(TAB_12369[ucAdder]) ; //²é±íÏÔÊ¾12,3,6,9
 153   5                                                      
 154   5                                              }
 155   4                                 /****************************************/   
 156   4                                        //ÏÔÊ¾Ö¸Õë"Ê±"
 157   4                              //         i = Hour ;
 158   4                              //       j = Hour ;
 159   4                              //      if ( ++i > 179 ) i=0 ;    //i+1,½á¹û>179,ÔòÇåÁã
 160   4                              //      if ( --j > 179 ) i=179 ;   //j-1,½á¹ûÎª¸º,ÔòÖØÐÂ¸³Öµ179
 161   4                                      if(( (Hour-2)<=DISP_LINE)&&((Hour+2)>=DISP_LINE) )
 162   4                                      {
 163   5                                              if(((Hour-1)==DISP_LINE)||((Hour+1)==DISP_LINE))
 164   5                                              {
 165   6                                                      PortD(0XFF);
 166   6                                                      PortC(0XBF);
 167   6                                              
 168   6                                              }
 169   5                                              else if(((Hour-2)==DISP_LINE)||((Hour+2)==DISP_LINE))
 170   5                                              {
 171   6                                                      PortD(0XFF);
 172   6                                                      PortC(0XDF);
 173   6                                                      
 174   6                                              }       
 175   5                                      }
 176   4                                      if(Hour==DISP_LINE)//||(DISP_LINE==i)||(DISP_LINE==j
 177   4                                  {
 178   5                                      
 179   5                                      PortD(0X80) ;
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 4   

 180   5                                              PortC(0X00);
 181   5                                              
 182   5                              
 183   5                              
 184   5                                  }    
 185   4                                  //ÏÔÊ¾Ö¸Õë"·Ö"
 186   4                                      if(( (Cent-2)<=DISP_LINE)&&((Cent+2)>=DISP_LINE) )
 187   4                                      {
 188   5                                              if(((Cent-1)==DISP_LINE)||((Cent+1)==DISP_LINE))
 189   5                                              {
 190   6                                                      PortC(0XFF);
 191   6                                                      PortB(0XFB);
 192   6                                                      PortD(0XFF);
 193   6                                              
 194   6                                              }       
 195   5                                              else if(((Cent-2)==DISP_LINE)||((Cent+2)==DISP_LINE))
 196   5                                              {
 197   6                                                      PortC(0XFF);
 198   6                                                      PortB(0XFD);
 199   6                                                      PortD(0XFF);
 200   6                                                      
 201   6                                              }
 202   5                                              
 203   5                                      }
 204   4                                      if(Cent==DISP_LINE)
 205   4                                  {
 206   5                                      //PortB=(0X00);
 207   5                                              PortC(0X00);
 208   5                                              PortB(0XF0);
 209   5                                              PortD(0X80);
 210   5                                              
 211   5                                      
 212   5                                  }
 213   4                                      //ÏÔÊ¾Ö¸Õë"Ãë"
 214   4                                      if(( (Sec-2)<=DISP_LINE)&&((Sec+2)>=DISP_LINE) )
 215   4                                      {
 216   5                                              if(((Sec-1)==DISP_LINE)||((Sec+1)==DISP_LINE))
 217   5                                              {
 218   6                                                      PortB(0XBF);
 219   6                                                      PortC(0XFF);
 220   6                                                      PortD(0XFF);
 221   6                                              
 222   6                                              }
 223   5                                              else if(((Sec-2)==DISP_LINE)||((Sec+2)==DISP_LINE))
 224   5                                              {
 225   6                                                      PortB(0XDF);
 226   6                                                      PortC(0XFF);
 227   6                                                      PortD(0XFF);
 228   6                                              }
 229   5                                                      
 230   5                                      }
 231   4                                  if(Sec==DISP_LINE)
 232   4                                  {
 233   5                                      PortB(0X00);
 234   5                                              PortC(0X00);
 235   5                                              PortD(0X80);
 236   5                                      
 237   5                                     
 238   5                                  }
 239   4                                      //DISP_LINE=DISP_LINE+1;
 240   4                                Show_R(Lzimo[(DISP_LINE+Offset)*2],Lzimo[(DISP_LINE+Offset)*2+1]);//ËÍ16*16ÎÄ×ÖÏÔÊ¾   
 241   4                              }
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 5   

 242   3                      }
 243   2            }
 244   1      }
 245          /*********************************************/
 246          void Init(void)
 247          {
 248   1              P0M0=0X00;//³õÊ¼»¯IO¿Ú Îª×¼Ë«Ïò¿Ú
 249   1              P0M1=0X00;
 250   1      
 251   1              P1M0=0X00;
 252   1              P1M1=0X00;
 253   1      
 254   1              P2M0=0X00;
 255   1              P2M1=0X00;
 256   1      
 257   1              P3M0=0X00;
 258   1              P3M1=0X00;
 259   1      
 260   1              P4M0=0X00;
 261   1              P4M1=0X00;
 262   1      
 263   1              P5M0=0X00;
 264   1              P5M1=0X00;
 265   1      
 266   1              P6M0=0X00;
 267   1              P6M1=0X00;
 268   1      
 269   1              P7M0=0X00;
 270   1              P7M1=0X00;
 271   1      
 272   1              Show_R(0x55,0x55);//²âÊÔ
 273   1              Show_L(0x55,0x55,0x55,0x55);//²âÊÔ
 274   1      
 275   1      AUXR &= 0x7F;           //¶¨Ê±Æ÷Ê±ÖÓ12TÄ£Ê½
 276   1              TMOD &= 0xF0;           //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 277   1              TMOD |= 0x01;           //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 278   1              TL0 = 0xCD;             //ÉèÖÃ¶¨Ê±³õÖµ
 279   1              TH0 = 0xFE;             //ÉèÖÃ¶¨Ê±³õÖµ
 280   1              TF0 = 0;                //Çå³ýTF0±êÖ¾
 281   1              TR0 = 1;                //¶¨Ê±Æ÷0¿ªÊ¼¼ÆÊ±
 282   1              ET0=1;
 283   1      
 284   1              AUXR &= 0xBF;           //¶¨Ê±Æ÷Ê±ÖÓ12TÄ£Ê½
 285   1              TMOD &= 0x0F;           //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 286   1              TMOD |= 0x20;           //ÉèÖÃ¶¨Ê±Æ÷Ä£Ê½
 287   1              TL1 = 0x12;             //ÉèÖÃ¶¨Ê±³õÖµ 155US
 288   1              TH1 = 0x12;             //ÉèÖÃ¶¨Ê±ÖØÔØÖµ
 289   1              TF1 = 0;                //Çå³ýTF1±êÖ¾
 290   1              ET1=1;
 291   1              TR1 = 0;                //¶¨Ê±Æ÷1¿ªÊ¼¼ÆÊ±
 292   1      
 293   1              SCON = 0x50; 
 294   1              T2L = (65536 - (FOSC/4/BAUD));   //ÉèÖÃ²¨ÌØÂÊÖØ×°Öµ
 295   1          T2H = (65536 - (FOSC/4/BAUD))>>8;
 296   1          AUXR = 0x14;                //T2Îª1TÄ£Ê½, ²¢Æô¶¯¶¨Ê±Æ÷2
 297   1          AUXR |= 0x01;               //Ñ¡Ôñ¶¨Ê±Æ÷2Îª´®¿Ú1µÄ²¨ÌØÂÊ·¢ÉúÆ÷
 298   1         // ES = 1;                     //Ê¹ÄÜ´®¿Ú1ÖÐ¶Ï
 299   1      
 300   1           IT0 = 1;    //Íâ²¿ÖÐ¶ÏÎª±ßÑØ´¥·¢
 301   1                         //ÉèÖÃINT0µÄÖÐ¶ÏÀàÐÍ (1:½öÏÂ½µÑØ 0:ÉÏÉýÑØºÍÏÂ½µÑØ)
 302   1           EX0 = 1;  //Ê¹ÄÜINT0ÖÐ¶Ï
 303   1      
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 6   

 304   1               IT1=1;
 305   1               EX1=1;//Íâ²¿ÖÐ¶Ï1 ÏÂ½µÑØ ÖÐ¶Ï
 306   1               EA = 1;                 
 307   1      }
 308          /************************************/
 309          void Timer0Interrupt(void) interrupt 1
 310          {                        
 311   1          Time0_flag=1;                  //¶¨Ê±ÖÐ¶Ï±êÖ¾Î»ÖÃ1;
 312   1              TH0=-Pt/256;TL0=-Pt%256;   //ÉèÖÃ¶¨Ê±Æ÷T0µÄ³õÉèÖµ
 313   1              DISP_LINE++;                    //¼ÆÊý
 314   1      }
 315          /*****Ö÷º¯Êý*****/
 316          void main(void)
 317          {
 318   1              Init();
 319   1              Auto_Set1302(starts_time);//×Ô¶¯³õÊ¼»¯Ê±ÖÓ
 320   1              Send_uart(0x55);
 321   1              
 322   1          //Ö÷³ÌÐò
 323   1              while(1)
 324   1          {           
 325   2              
 326   2                      if((ucMode==2)||(ucMode==3))
 327   2                      {
 328   3                              display_pic();
 329   3                      }
 330   2                       //BIT_timeout=1;
 331   2                      if(BIT_timeout==1)      //ÆðµãÅÐ¶Ï
 332   2                      {                       
 333   3                              BIT_timeout=0; //ÇåÁã
 334   3                              
 335   3                              Scan_bit=1;// Æðµã¼ì²âµ½ºó LED²»ÔÙÁ÷Ë®²âÊÔ
 336   3                              if( new_code ) //ÓÐºìÍâ°´¼ü
 337   3                              {
 338   4                                      new_code=0;
 339   4                                      switch( key_code ) //¸ù¾Ý²»Í¬µÄ°´¼üÖµÖ´ÐÐ²»Í¬µÄ¶¯×÷
 340   4                                      {       
 341   5                                         case 0x0C:
 342   5                                              ucMode=0x01;//Êý×ÖÖÓÄ£Ê½+²àÃæÎÄ×Ö
 343   5                                              TR0 = 0;        
 344   5                                      break;
 345   5      
 346   5                                      case 0x18:
 347   5                                              ucMode=0x02;//Ö¸ÕëÊ½Ê±ÖÓÄ£Ê½
 348   5                                              TR0 = 1;
 349   5                                      break;
 350   5                                      case 0x5E:
 351   5                                      //      ucMode=0x03;//Ö¸ÕëÊ±ÖÓÄ£Ê½
 352   5                                              TR0=1;                          
 353   5                                      break;
 354   5                                              case 0x40:       //µ÷Ê±¼Ó
 355   5                                                      Set(id,1);
 356   5      
 357   5                                              break;
 358   5              
 359   5                                              case 0x19: //µ÷Ê±¼õ                             
 360   5                                                              Set(id,0); 
 361   5                                              
 362   5                                              break;
 363   5                                              
 364   5                                              case 0x15://µ÷Ê±ÇÐ»»
 365   5                                                                      id++;                                           
C51 COMPILER V8.08   TASK                                                                  05/28/2015 23:34:49 PAGE 7   

 366   5                                                                      if(id>5)
 367   5                                                                      {
 368   6                                                                      id=0;
 369   6                                                                      }
 370   5                                              break;
 371   5                                              case 0x47://Ê±ÖÓ³õÊ¼»¯
 372   5                                                              Set1302(starts_time);    //³õÊ¼»¯ 
 373   5                                                              W1302(0x8e,0x00); //¿ØÖÆÃüÁî,WP=0,Ð´²Ù×÷                
 374   5                                                              W1302(0x90,0xa5); //´òª³äµ¶þ¼¶Ü  Ò»¸ö¶þ¼¶¹Ü´®ÁªÒ»¸ö2Kçè
 375   5                                                              //write_1302Data(DISP_TIME_adder,160);
 376   5                                              break;
 377   5              
 378   5                                              default: break;
 379   5                                      }
 380   4                                      key_code=0;
 381   4                              }
 382   3                      
 383   3                              if(ucMode==1)
 384   3                              {
 385   4                                      du1302();//¶ÁÈ¡Ê±ÖÓÐ¾Æ¬ µÄÊ±ÖÓÊý¾Ý
 386   4                                      Show_line_time();//ÏÔÊ¾Ê±¼ä
 387   4                              }
 388   3          
 389   3                  
 390   3                      }   
 391   2          
 392   2                      }
 393   1      }
 394          /*********************************************************************************/
 395          /*************************************************************************************
 396          ************************************************************************************
 397          ***********************                                     ***************************
 398          ***********************    http://59tiaoba.taobao.com       ***************************
 399          ***********************                                     ***************************
 400          ************************************************************************************
 401          **********************************************************************************/


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1256    ----
   CONSTANT SIZE    =     32    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      3    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
